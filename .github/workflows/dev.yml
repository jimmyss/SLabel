name: dev

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-20.04
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Connect to Server and Deploy
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        port: ${{ secrets.PORT }} # Default is 22
        script_stop: true
        script: |
          cd /home/SLabel
          git pull origin main
          # Backend build and run commands
          cd Backend/slabel
          ./gradlew clean
          ./gradlew build -x test
          # You might want to kill the current backend process before restarting
          java -jar build/libs/slabel-0.0.1-SNAPSHOT.jar &
          cd ../..
          # Frontend build commands
          cd Frontend/slabel_front
          npm install
          npm run build
          # Use a reverse proxy or any server to serve your frontend files
          # For example, restart Nginx to load new static files
          cp -r /home/SLabel/Frontend/slabel_front/dist /var/www/dist
          sudo systemctl restart nginx
